<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>영어 단어 학습 앱 (사용자 정의 버전)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .main-card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease;
        }
        .btn {
            transition: all 0.2s ease-in-out;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .btn-active {
            background-color: #3B82F6 !important;
            color: white !important;
            border-color: #3B82F6 !important;
        }
        .word-card .details {
            display: none;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out;
        }
        .word-card.expanded .details {
            display: block;
            max-height: 500px;
            transition: max-height 0.5s ease-in;
        }
        .word-card.expanded .summary svg.expand-arrow {
            transform: rotate(180deg);
        }
        .summary svg.expand-arrow {
            transition: transform 0.3s ease;
        }
        .speaking-highlight {
            background-color: #FEF3C7 !important; /* yellow-200 */
            transform: scale(1.02);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-5xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800">영어 단어 학습</h1>
            <p class="text-gray-600 mt-2">학습할 주차를 선택하고 시작하세요.</p>
        </header>

        <main class="main-card p-6 md:p-8">
            <!-- 주차 선택 -->
            <div class="border-b-2 border-gray-200 pb-6 mb-6">
                <h3 class="text-lg font-semibold text-gray-700 mb-4 text-center">주차 선택</h3>
                <div id="week-selection" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3">
                    <!-- Week buttons will be dynamically inserted here -->
                </div>
            </div>
            
            <!-- 선택한 주차 학습 (주차 선택 시 활성화) -->
            <div id="week-actions-container" class="hidden border-b-2 border-gray-200 pb-6 mb-6">
                <h3 class="text-lg font-semibold text-gray-700 mb-4 text-center">선택한 주차 학습</h3>
                <div id="mode-selection" class="flex flex-wrap justify-center gap-2 md:gap-4 mb-4">
                    <button data-mode="list" class="btn mode-btn bg-gray-200 text-gray-700 font-medium py-2 px-4 rounded-lg">Week 전체 단어 보기</button>
                    <button data-mode="listen-all" class="btn mode-btn bg-orange-400 text-white font-medium py-2 px-4 rounded-lg">Week 전체 단어 듣기</button>
                    <button data-mode="test-eng-kor" class="btn mode-btn bg-gray-200 text-gray-700 font-medium py-2 px-4 rounded-lg">Week 전체 테스트 (영→한)</button>
                    <button data-mode="test-kor-eng" class="btn mode-btn bg-gray-200 text-gray-700 font-medium py-2 px-4 rounded-lg">Week 전체 테스트 (한→영)</button>
                </div>
                <div id="unit-test-selection" class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    <!-- Unit test buttons will be inserted here -->
                </div>
            </div>

            <!-- 콘텐츠 표시 영역 -->
            <div id="content-display" class="min-h-[450px]">
                <div id="initial-message" class="text-center text-gray-500 pt-16">
                    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                      <path vector-effect="non-scaling-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <h3 class="mt-2 text-sm font-medium text-gray-900">학습 시작하기</h3>
                    <p class="mt-1 text-sm text-gray-500">먼저 학습할 주차를 선택해주세요.</p>
                </div>
            </div>

            <!-- 페이지네이션 -->
            <div id="pagination" class="hidden justify-center items-center mt-6 gap-4">
                <button id="prev-page" class="btn bg-white py-2 px-4 rounded-lg shadow-md hover:bg-gray-50 text-gray-700 font-medium disabled:opacity-50 disabled:cursor-not-allowed">이전</button>
                <span id="page-info" class="text-gray-700 font-semibold"></span>
                <button id="next-page" class="btn bg-white py-2 px-4 rounded-lg shadow-md hover:bg-gray-50 text-gray-700 font-medium disabled:opacity-50 disabled:cursor-not-allowed">다음</button>
            </div>
        </main>
    </div>

    <script>
        const wordData = {
            'week1': [
                { english: 'square', korean: '정사각형, 광장, 평방, 제곱', pronunciation: '[skweər]', related: 'rectangle 직사각형, pentagon 오각형', synonyms: 'plaza', example: 'There are 64 squares on a chessboard.'}
            ],
            'week2': [
                { english: 'assure', korean: '확신시키다, 보증하다', pronunciation: '[əʃúər]', related: 'assurance 확신, 보증, assured 확실한, 자신 있는', synonyms: 'convince, confidence, certain, confident', example: 'Her doctor has assured her family that she would be fine.'}
            ],
            'week3': [
                { english: 'interest', korean: '관심, 흥미, 이자, 이익', pronunciation: '[íntərist]', related: 'interested 흥미를 가진, interesting 흥미있는', example: "Enya's success has contributed greatly to the current interest in Celtic music."}
            ],
            'week4': [
                { english: 'helpless', korean: '무기력한, 의지할 데 없는', pronunciation: '[hélplis]', related: 'helplessly 무기력하게', example: 'The helpless orphan was taken good care of by her relatives, who treated her like their own daughter.' }
            ],
            'week5': [
                { english: 'security', korean: '안전, 보안', pronunciation: '[sikjúəriti]', related: 'secure 안전한, 확보하다', synonyms: 'safety, safeguard', example: 'Were it not for the police, social security would be impossible.'}
            ],
            'week6': [
                { english: 'accurate', korean: '정확한, 빈틈없는', pronunciation: '[ǽkjurit]', related: 'accuracy 정확, 정밀', synonyms: 'precise', antonyms: 'inaccurate', example: 'The brochure appears to give a fair and accurate description of each hotel.' }
            ],
            'week7': [
                { english: 'transportation', korean: '수송, 운송, 교통', pronunciation: '[træ̀nspərtéiʃən]', related: 'transport 수송하다', synonyms: 'convey', example: 'The rising cost of energy has brought about the need of energy-saving transportation.' }
            ],
            'week8': [
                { english: 'fragrant', korean: '냄새 좋은, 향기로운, 유쾌한', pronunciation: '[fréigrənt]', related: 'fragrance 향기, 방향', synonyms: 'aromatic', example: 'The forest was cool and fragrant, and the walk through it calmed my spirits.' }
            ],
            'week9': [
                { english: 'prefer', korean: '더 좋아하다, 선호하다', pronunciation: '[prifə́ːr]', related: 'preference 선호, preferable 더 나은', example: 'The average person tends to prefer good listeners to good talkers.' }
            ],
            'week10': [
                { english: 'resource', korean: '자원, 수단, 재치', pronunciation: '[ríːsɔːrs]', related: 'resourceful 자원이 풍부한, 재치있는', synonyms: 'wit', example: 'We cannot deny the fact that we are abusing natural resources.' }
            ]
        };

        // --- 상태 변수 ---
        let allWords = [];
        let selectedWeekKey = null;
        let currentWords = [];
        let testableWords = []; 
        let currentMode = 'list';
        let currentPage = 1;
        const wordsPerPage = 10;
        let currentTestWord = null;
        let isSpeakingAll = false;
        let speakQueue = [];
        let currentSpeakingCard = null;
        let voices = []; // 사용 가능한 음성 목록을 저장할 배열

        // --- DOM 요소 ---
        const weekSelection = document.getElementById('week-selection');
        const weekActionsContainer = document.getElementById('week-actions-container');
        const modeSelection = document.getElementById('mode-selection');
        const unitTestSelection = document.getElementById('unit-test-selection');
        const contentDisplay = document.getElementById('content-display');
        const pagination = document.getElementById('pagination');
        const initialMessage = document.getElementById('initial-message');
        const prevPageBtn = document.getElementById('prev-page');
        const nextPageBtn = document.getElementById('next-page');
        const pageInfo = document.getElementById('page-info');
        
        // --- 초기화 ---
        function init() {
            processAllWords();
            loadVoices(); // 음성 목록 로드
            createWeekButtons();
            addEventListeners();
        }
        
        // --- 음성 관련 함수 ---
        /**
         * 브라우저에서 사용 가능한 음성 목록을 가져와 voices 배열에 저장합니다.
         * 비동기적으로 로드될 수 있으므로, voiceschanged 이벤트를 사용하여 목록이 준비되면 업데이트합니다.
         */
        function loadVoices() {
            if (typeof window.speechSynthesis === 'undefined') {
                console.warn('Web Speech API is not supported in this browser.');
                return;
            }
            voices = window.speechSynthesis.getVoices();
            if (voices.length > 0) {
                return;
            }
            window.speechSynthesis.onvoiceschanged = () => {
                voices = window.speechSynthesis.getVoices();
            };
        }

        /**
         * 주어진 영어와 한국어 텍스트를 순차적으로 읽어줍니다.
         * @param {string} english - 읽을 영어 텍스트
         * @param {string} korean - 읽을 한국어 텍스트
         * @param {function} [callback] - 음성 재생이 모두 끝난 후 실행될 콜백 함수
         */
        function speakWord(english, korean, callback) {
            if (typeof SpeechSynthesisUtterance === 'undefined' || typeof window.speechSynthesis === 'undefined') {
                alert('이 브라우저는 음성 합성을 지원하지 않습니다.');
                if (callback) callback();
                return;
            }
            
            window.speechSynthesis.cancel(); // 진행 중인 음성 취소

            const englishUtterance = new SpeechSynthesisUtterance(english);
            const koreanUtterance = new SpeechSynthesisUtterance(korean);
            
            // 사용 가능한 음성 중에서 영어와 한국어 음성을 찾습니다.
            const englishVoice = voices.find(voice => voice.lang.startsWith('en-')) || voices.find(voice => voice.default && voice.lang.startsWith('en-'));
            const koreanVoice = voices.find(voice => voice.lang.startsWith('ko-')) || voices.find(voice => voice.default && voice.lang.startsWith('ko-'));

            englishUtterance.lang = 'en-US';
            if (englishVoice) {
                englishUtterance.voice = englishVoice;
            }
            englishUtterance.rate = 0.9;

            koreanUtterance.lang = 'ko-KR';
            if (koreanVoice) {
                koreanUtterance.voice = koreanVoice;
            }
            koreanUtterance.rate = 0.9;

            englishUtterance.onend = () => {
                setTimeout(() => {
                    window.speechSynthesis.speak(koreanUtterance);
                }, 200); // 단어 사이 짧은 간격
            };

            koreanUtterance.onend = () => {
                if (callback) {
                    callback();
                }
            };
            
            window.speechSynthesis.speak(englishUtterance);
        }

        // --- 데이터 처리 ---
        function processAllWords() {
            let globalId = 1;
            for (const weekKey in wordData) {
                wordData[weekKey] = wordData[weekKey].map(word => {
                    const wordWithId = {...word, id: globalId++};
                    allWords.push(wordWithId);
                    return wordWithId;
                });
            }
        }

        // --- UI 생성 및 이벤트 핸들러 ---
        function createWeekButtons() {
            for (let i = 1; i <= 10; i++) {
                const button = document.createElement('button');
                button.dataset.week = `week${i}`;
                button.className = 'btn week-btn bg-white text-blue-600 font-semibold py-2 px-4 border border-blue-500 rounded-md shadow-sm hover:bg-blue-50';
                button.textContent = `Week ${i}`;
                weekSelection.appendChild(button);
            }
        }
        
        function addEventListeners() {
            weekSelection.addEventListener('click', (e) => {
                if (e.target.matches('.week-btn')) {
                    handleWeekSelection(e.target.dataset.week);
                    document.querySelectorAll('.btn').forEach(btn => btn.classList.remove('btn-active'));
                    e.target.classList.add('btn-active');
                }
            });
            
            modeSelection.addEventListener('click', (e) => {
                if (e.target.matches('.mode-btn')) {
                    const mode = e.target.dataset.mode;
                    if (mode === 'listen-all') {
                        handleListenAll();
                    } else {
                        stopSpeakAllWords();
                        currentWords = wordData[selectedWeekKey];
                        setMode(mode);
                    }
                }
            });

            unitTestSelection.addEventListener('click', (e) => {
                if (e.target.matches('.unit-btn')) {
                    stopSpeakAllWords();
                    const start = parseInt(e.target.dataset.start);
                    const end = parseInt(e.target.dataset.end);
                    const mode = e.target.dataset.mode;
                    const weekWords = wordData[selectedWeekKey];
                    currentWords = weekWords.slice(start - 1, end);
                    
                    document.querySelectorAll('.btn').forEach(btn => btn.classList.remove('btn-active'));
                    e.target.classList.add('btn-active');
                    setMode(mode);
                }
            });
            
            prevPageBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderList();
                }
            });

            nextPageBtn.addEventListener('click', () => {
                const totalPages = Math.ceil(currentWords.length / wordsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    renderList();
                }
            });

            contentDisplay.addEventListener('click', (e) => {
                const speakBtn = e.target.closest('.speak-btn');
                const card = e.target.closest('.word-card');

                if (speakBtn) {
                    e.stopPropagation(); // 카드 확장 방지
                    const english = speakBtn.dataset.english;
                    const korean = speakBtn.dataset.korean;
                    speakWord(english, korean);
                    return;
                }

                if (card) {
                    card.classList.toggle('expanded');
                }
            });
        }

        function handleWeekSelection(weekKey) {
            stopSpeakAllWords();
            selectedWeekKey = weekKey;
            const wordsInWeek = wordData[weekKey];

            if (wordsInWeek.length === 0) {
                contentDisplay.innerHTML = `<p class="text-center text-gray-500 pt-16">선택한 주차에 단어가 없습니다. 스크립트에서 단어를 추가해주세요.</p>`;
                weekActionsContainer.classList.add('hidden');
                pagination.classList.add('hidden');
                initialMessage.classList.add('hidden');
                return;
            }
            
            currentWords = wordsInWeek;
            currentPage = 1;
            
            initialMessage.classList.add('hidden');
            weekActionsContainer.classList.remove('hidden');
            
            updateUnitButtons();
            setMode('list');
        }

        function updateUnitButtons() {
            unitTestSelection.innerHTML = '';
            const wordsInWeek = wordData[selectedWeekKey];
            if (!wordsInWeek || wordsInWeek.length === 0) {
                unitTestSelection.parentElement.classList.add('hidden');
                return;
            }
            unitTestSelection.parentElement.classList.remove('hidden');

            const unitCount = Math.ceil(wordsInWeek.length / 30);
            for (let i = 0; i < unitCount; i++) {
                const start = i * 30 + 1;
                const end = Math.min((i + 1) * 30, wordsInWeek.length);

                const btnEngKor = document.createElement('button');
                btnEngKor.dataset.start = start;
                btnEngKor.dataset.end = end;
                btnEngKor.dataset.mode = 'test-eng-kor';
                btnEngKor.className = 'btn unit-btn bg-white text-green-600 font-semibold py-2 px-3 border border-green-500 rounded-md shadow-sm hover:bg-green-50 text-sm';
                btnEngKor.textContent = `Words ${start}-${end} (영→한)`;
                unitTestSelection.appendChild(btnEngKor);

                const btnKorEng = document.createElement('button');
                btnKorEng.dataset.start = start;
                btnKorEng.dataset.end = end;
                btnKorEng.dataset.mode = 'test-kor-eng';
                btnKorEng.className = 'btn unit-btn bg-white text-teal-600 font-semibold py-2 px-3 border border-teal-500 rounded-md shadow-sm hover:bg-teal-50 text-sm';
                btnKorEng.textContent = `Words ${start}-${end} (한→영)`;
                unitTestSelection.appendChild(btnKorEng);
            }
        }
        
        // --- 전체 듣기 기능 ---
        function handleListenAll() {
            if (isSpeakingAll) {
                stopSpeakAllWords();
            } else {
                startSpeakAllWords();
            }
        }

        function startSpeakAllWords() {
            isSpeakingAll = true;
            const listenBtn = document.querySelector('[data-mode="listen-all"]');
            listenBtn.textContent = '듣기 중지';
            listenBtn.classList.add('bg-red-500');
            listenBtn.classList.remove('bg-orange-400');
            
            setMode('list'); // 단어 목록 보기 모드로 전환
            
            speakQueue = [...wordData[selectedWeekKey]];
            speakNextInQueue();
        }

        function stopSpeakAllWords() {
            isSpeakingAll = false;
            speakQueue = [];
            if (typeof window.speechSynthesis !== 'undefined') {
                window.speechSynthesis.cancel();
            }
            
            const listenBtn = document.querySelector('[data-mode="listen-all"]');
            if(listenBtn) {
                listenBtn.textContent = 'Week 전체 단어 듣기';
                listenBtn.classList.remove('bg-red-500');
                listenBtn.classList.add('bg-orange-400');
            }

            if (currentSpeakingCard) {
                currentSpeakingCard.classList.remove('speaking-highlight');
                currentSpeakingCard = null;
            }
        }

        function speakNextInQueue() {
            if (!isSpeakingAll || speakQueue.length === 0) {
                stopSpeakAllWords();
                return;
            }

            const word = speakQueue.shift();
            
            if (currentSpeakingCard) {
                currentSpeakingCard.classList.remove('speaking-highlight');
            }
            currentSpeakingCard = document.querySelector(`.word-card[data-word-id="${word.id}"]`);
            if (currentSpeakingCard) {
                currentSpeakingCard.classList.add('speaking-highlight');
                currentSpeakingCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            speakWord(word.english, word.korean.split(',')[0], () => {
                setTimeout(speakNextInQueue, 500); // 단어 사이 0.5초 딜레이
            });
        }

        // --- 렌더링 함수 ---
        function setMode(mode) {
            currentMode = mode;
            if (weekActionsContainer.offsetParent !== null) {
                 document.querySelectorAll('.mode-btn').forEach(btn => {
                    if (btn.dataset.mode === mode) {
                        if(mode !== 'listen-all') btn.classList.add('btn-active');
                    }
                    else btn.classList.remove('btn-active');
                });
            }

            if (mode === 'list' || mode === 'listen-all') {
                renderList();
            } else {
                testableWords = [...currentWords]; 
                pagination.classList.add('hidden');
                renderTest();
            }
        }

        function createDetailHtml(word) {
            let html = `<div class="text-sm space-y-2 text-left text-gray-700">`;
            html += `<p><strong>뜻:</strong> ${word.korean}</p>`;
            if (word.pronunciation) html += `<p><strong>발음:</strong> ${word.pronunciation}</p>`;
            if (word.synonyms) html += `<p><strong>동의어:</strong> ${word.synonyms}</p>`;
            if (word.antonyms) html += `<p><strong>반의어:</strong> ${word.antonyms}</p>`;
            if (word.related) html += `<p><strong>관련어:</strong> ${word.related}</p>`;
            if (word.example) html += `<p class="mt-2 pt-2 border-t"><strong>예문:</strong> <span class="italic">${word.example}</span></p>`;
            html += `</div>`;
            return html;
        }

        function renderList() {
            contentDisplay.innerHTML = '';
            const startIndex = (currentPage - 1) * wordsPerPage;
            const endIndex = startIndex + wordsPerPage;
            const paginatedWords = currentWords.slice(startIndex, endIndex);

            const listContainer = document.createElement('div');
            listContainer.className = 'w-full space-y-3';

            paginatedWords.forEach(word => {
                const wordCard = document.createElement('div');
                wordCard.className = 'word-card bg-gray-50 p-4 rounded-lg shadow-sm hover:bg-gray-100 transition-all duration-300';
                wordCard.dataset.wordId = word.id;
                wordCard.innerHTML = `
                    <div class="summary flex justify-between items-center">
                        <div class="flex-grow cursor-pointer">
                            <span class="text-lg font-semibold text-gray-800">${word.id}. ${word.english}</span>
                            <span class="text-md text-gray-600 ml-4">${word.korean.split(',')[0]}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                             <button class="speak-btn p-2 rounded-full hover:bg-gray-200" data-english="${word.english}" data-korean="${word.korean.split(',')[0]}">
                                <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M11 5.882V19.118a2 2 0 01-2.828 1.414l-4.243-4.243a2 2 0 010-2.828l4.243-4.243A2 2 0 0111 5.882z"></path></svg>
                            </button>
                            <svg class="w-6 h-6 text-gray-500 expand-arrow cursor-pointer" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                    </div>
                    <div class="details mt-4 border-t pt-4">
                        ${createDetailHtml(word)}
                    </div>
                `;
                listContainer.appendChild(wordCard);
            });
            contentDisplay.appendChild(listContainer);
            updatePagination();
        }

        function updatePagination() {
            if (!currentWords || currentWords.length === 0 || currentMode !== 'list') {
                pagination.classList.add('hidden');
                return;
            }
            const totalPages = Math.ceil(currentWords.length / wordsPerPage);
            pageInfo.textContent = `페이지 ${currentPage} / ${totalPages}`;
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages;
            
            if (totalPages > 1) {
                pagination.classList.remove('hidden');
                pagination.classList.add('flex');
            } else {
                pagination.classList.add('hidden');
            }
        }

        function renderTest() {
            currentTestWord = pickRandomTestWord();
            let question, answer;

            if (!currentTestWord) {
                contentDisplay.innerHTML = `
                    <div class="text-center text-gray-600 pt-16">
                        <h3 class="text-2xl font-bold text-green-600">테스트 완료!</h3>
                        <p class="mt-2">선택한 범위의 모든 단어를 학습했습니다.</p>
                    </div>
                `;
                return;
            }

            if (currentMode === 'test-eng-kor') {
                question = `${currentTestWord.id}. ${currentTestWord.english}`;
                answer = currentTestWord.korean;
            } else {
                question = currentTestWord.korean;
                answer = `${currentTestWord.id}. ${currentTestWord.english}`;
            }

            contentDisplay.innerHTML = `
                <div class="w-full max-w-lg text-center mx-auto">
                    <div class="main-card p-8">
                        <p class="text-gray-500 text-sm mb-2">${currentMode === 'test-eng-kor' ? '다음 단어의 뜻은?' : '다음 뜻을 가진 영어 단어는?'}</p>
                        <h2 class="text-4xl font-bold text-blue-600 mb-6 break-words">${question}</h2>
                        <div id="answer-area" class="min-h-[4rem] flex flex-col items-center justify-center">
                            <button id="show-answer-btn" class="btn bg-blue-500 text-white font-bold py-2 px-6 rounded-full hover:bg-blue-600">정답 확인</button>
                            <div id="test-details" class="hidden w-full mt-4 p-4 bg-gray-100 rounded-lg"></div>
                        </div>
                    </div>
                    <button id="next-question-btn" class="btn mt-6 bg-green-500 text-white font-bold py-3 px-8 rounded-full hover:bg-green-600">다음 문제 (${testableWords.length}개 남음)</button>
                </div>
            `;
            
            document.getElementById('show-answer-btn').addEventListener('click', () => {
                const answerArea = document.getElementById('answer-area');
                const testDetails = document.getElementById('test-details');
                answerArea.querySelector('button').classList.add('hidden');
                answerArea.insertAdjacentHTML('afterbegin', `<p class="text-2xl font-semibold text-green-600 break-words">${answer}</p>`);
                testDetails.innerHTML = createDetailHtml(currentTestWord);
                testDetails.classList.remove('hidden');
            });

            document.getElementById('next-question-btn').addEventListener('click', renderTest);
        }

        function pickRandomTestWord() {
            if (!testableWords || testableWords.length === 0) {
                return null;
            }
            const randomIndex = Math.floor(Math.random() * testableWords.length);
            const [word] = testableWords.splice(randomIndex, 1);
            return word;
        }

        init();
    </script>
</body>
</html>